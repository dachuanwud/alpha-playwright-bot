# 多账号启动与运行指南

## 📋 目录
1. [安装依赖](#1-安装依赖)
2. [配置账号](#2-配置账号)
3. [启动 Chrome 实例](#3-启动-chrome-实例)
4. [运行脚本](#4-运行脚本)
5. [常见问题](#5-常见问题)

---

## 1. 安装依赖

```bash
# 安装所有依赖（包括新增的 pyyaml）
pip install -r requirements.txt

# 或者单独安装 pyyaml
pip install pyyaml
```

---

## 2. 配置账号

编辑 `accounts.yaml` 文件，配置你的账号信息：

```yaml
# 全局默认配置
defaults:
  cost: 256                    # 单次交易额
  total_runs: 36               # 执行次数
  # ... 其他配置

# 账号列表
accounts:
  - name: "账号A"
    enabled: true              # 设为 true 启用
    port: 9222                 # Chrome 调试端口
    secret: "你的验证器密钥"    # 谷歌验证器密钥（可选）
    # 可覆盖默认配置
    # cost: 300

  - name: "账号B"
    enabled: true
    port: 9223
    secret: ""
```

**重要配置项：**
- `name`: 账号名称（唯一标识）
- `enabled`: 是否启用（`true`/`false`）
- `port`: Chrome 调试端口（每个账号必须不同）
- `secret`: 谷歌验证器密钥（留空则不自动填验证码）

---

## 3. 启动 Chrome 实例

### 3.1 找到 Chrome 可执行文件路径

**Windows 常见路径：**
```
C:\Program Files\Google\Chrome\Application\chrome.exe
C:\Program Files (x86)\Google\Chrome\Application\chrome.exe
```

**或者使用快捷方式：**
- 右键桌面 Chrome 图标 → 属性 → 查看"目标"路径

### 3.2 为每个账号启动独立的 Chrome

**方式一：使用命令行（推荐）**

打开 PowerShell 或 CMD，依次执行：

```powershell
# 账号A - 端口 9222
& "C:\Program Files\Google\Chrome\Application\chrome.exe" `
  --remote-debugging-port=9222 `
  --user-data-dir="C:\ChromeProfiles\AccountA"

# 账号B - 端口 9223（新开一个命令行窗口）
& "C:\Program Files\Google\Chrome\Application\chrome.exe" `
  --remote-debugging-port=9223 `
  --user-data-dir="C:\ChromeProfiles\AccountB"
```

**方式二：创建批处理文件（.bat）**

创建 `start_chrome_accountA.bat`：
```batch
@echo off
"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="C:\ChromeProfiles\AccountA"
pause
```

创建 `start_chrome_accountB.bat`：
```batch
@echo off
"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9223 --user-data-dir="C:\ChromeProfiles\AccountB"
pause
```

双击运行这些 `.bat` 文件即可启动 Chrome。

### 3.3 首次登录

1. **打开每个 Chrome 窗口**
2. **访问 Binance 并登录**
   - 打开：https://www.binance.com
   - 扫码或输入密码登录
   - 确保登录成功
3. **打开交易页面**
   - 导航到现货交易页面
   - 例如：https://www.binance.com/zh-CN/trade/BTC_USDT
4. **保持 Chrome 窗口打开**（可以最小化）

**重要提示：**
- ✅ 每个 Chrome 窗口对应一个账号
- ✅ 登录后不要关闭 Chrome 窗口
- ✅ 可以最小化到后台运行
- ✅ 下次启动 Chrome 会自动恢复登录状态

---

## 4. 运行脚本

### 4.1 查看账号列表

```bash
python multi_runner.py --list
```

输出示例：
```
📋 账号列表 (共 2 个):
--------------------------------------------------
  账号A
    状态: ✅ 启用
    端口: 9222
    验证器: 🔐

  账号B
    状态: ✅ 启用
    端口: 9223
    验证器: ⚠️
--------------------------------------------------
共 2 个账号已启用
```

### 4.2 预览模式（不实际启动）

```bash
python multi_runner.py --dry-run
```

用于检查配置是否正确，不会实际启动交易。

### 4.3 启动所有账号

```bash
python multi_runner.py
```

**运行效果：**
```
============================================================
🚀 多账号启动器 - 共 2 个账号
============================================================
🚀 启动账号: 账号A (端口: 9222)
   等待 3 秒后启动下一个账号...
🚀 启动账号: 账号B (端口: 9223)

============================================================
📊 账号运行状态 (14:30:25)
============================================================
  🟢 账号A: running (PID:12345 | 运行:0h 0m)
  🟢 账号B: running (PID:12346 | 运行:0h 0m)

📡 开始监控，每 60 秒刷新状态 (Ctrl+C 停止)
------------------------------------------------------------
```

### 4.4 启动单个账号（调试用）

```bash
python main.py --account "账号A"
```

用于单独测试某个账号。

### 4.5 停止所有账号

按 `Ctrl + C` 即可优雅停止所有账号进程。

---

## 5. 常见问题

### Q1: Chrome 启动失败

**问题：** 提示端口被占用

**解决：**
```bash
# 检查端口占用
netstat -ano
netstat -ano | findstr :9222

# 关闭占用端口的进程（替换 PID）
taskkill /PID <进程ID> /F
```

### Q2: 找不到 Chrome 可执行文件

**解决：**
1. 找到 Chrome 安装路径
2. 修改启动命令中的路径
3. 或创建环境变量 `CHROME_PATH`

### Q3: 账号登录状态丢失

**原因：** Chrome 窗口被关闭或崩溃

**解决：**
1. 重新启动对应端口的 Chrome
2. 重新登录
3. 保持 Chrome 窗口打开

### Q4: 多账号同时运行卡顿

**优化建议：**
- 减少同时运行的账号数量
- 关闭不必要的 Chrome 标签页
- 增加监控间隔：`python multi_runner.py --monitor 120`

### Q5: 如何查看日志

**日志位置：**
```
logs/
  ├── 账号A_20241204.log
  ├── 账号B_20241204.log
  └── bot_20241204.log          # 默认日志
```

**查看实时日志：**
```bash
# Windows PowerShell
Get-Content logs\账号A_20241204.log -Wait -Tail 50

# CMD
type logs\账号A_20241204.log
```

### Q6: 验证器密钥在哪里找？

1. 打开 Binance 手机 App
2. 进入"安全" → "双重验证"
3. 查看"Google 验证器"
4. 复制密钥（16位大写字母+数字）

### Q7: 如何修改账号配置？

编辑 `accounts.yaml`，修改对应账号的配置项，然后重启脚本。

---

## 📝 完整启动流程示例

```bash
# 1. 安装依赖
pip install pyyaml

# 2. 编辑配置文件
notepad accounts.yaml

# 3. 启动 Chrome（每个账号一个窗口）
# 打开 PowerShell，执行：
& "C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="C:\ChromeProfiles\AccountA"

# 4. 在 Chrome 中登录 Binance

# 5. 启动交易脚本
python multi_runner.py

# 6. 查看状态（每60秒自动刷新）
# 按 Ctrl+C 停止
```

---

## 🎯 快速检查清单

启动前确认：
- [ ] 已安装 `pyyaml`
- [ ] `accounts.yaml` 配置正确
- [ ] 每个账号的端口不重复
- [ ] Chrome 已启动并登录
- [ ] Chrome 窗口保持打开
- [ ] 已打开 Binance 交易页面

---

## 💡 提示

1. **首次使用：** 建议先用 `--dry-run` 检查配置
2. **单账号测试：** 先用 `python main.py --account "账号A"` 测试
3. **日志监控：** 定期查看日志文件了解运行状态
4. **Chrome 管理：** 建议创建桌面快捷方式方便启动
5. **资源占用：** 每个账号会占用一定内存，注意系统资源

---

## 📞 需要帮助？

如果遇到问题：
1. 查看日志文件：`logs/账号名_日期.log`
2. 检查 Chrome 是否正常运行
3. 确认端口未被占用
4. 验证 `accounts.yaml` 配置格式是否正确

